---
import "@src/styles/reset.css";
import "@src/styles/globals.css";
import Nav from "@components/nav.astro";
import Footer from "@components/footer.astro";

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
}

const { title = "@iammatthias", description = "Personal site of Matthias Jordan", ogImage = "/" } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// Use OG subdomain for production, localhost for development
const ogImageURL = import.meta.env.DEV
  ? new URL(ogImage, "http://localhost:8787")
  : new URL(ogImage, "https://og.iammatthias.com");
---

<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover' />

    <meta name='color-scheme' content='light dark' />
    <meta name='theme-color' content='#0f1419' />

    <title>{title}</title>
    <meta name='description' content={description} />
    <link rel='canonical' href={canonicalURL} />

    <!-- Open Graph / Facebook -->
    <meta property='og:type' content='website' />
    <meta property='og:url' content={canonicalURL} />
    <meta property='og:title' content={title} />
    <meta property='og:description' content={description} />
    <meta property='og:image' content={ogImageURL} />

    <!-- Twitter -->
    <meta property='twitter:card' content='summary_large_image' />
    <meta property='twitter:url' content={canonicalURL} />
    <meta property='twitter:title' content={title} />
    <meta property='twitter:description' content={description} />
    <meta property='twitter:image' content={ogImageURL} />

    <link rel='alternate' type='application/rss+xml' title='iammatthias - All Content' href='/rss.xml' />
    <link rel='sitemap' href='/sitemap-index.xml' />

    <link
      rel='icon'
      href='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â˜¼</text></svg>'
    />
  </head>
  <body>
    <div class='with-sidebar'>
      <main>
        <Nav />
        <slot name='main' />
        <Footer />
      </main>
      <slot name='sidebar' />
    </div>
    <div class='veil' aria-hidden='true'>
      <div class='veil-overlay'></div>
    </div>
  </body>
</html>

<style>
  .with-sidebar {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    min-height: calc(100dvh - 2rem);
    &:before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      box-shadow:
        inset 0px 0px 0px 16px var(--color-background),
        inset 0px 0px 0px 17px var(--color-caret);
      pointer-events: none;
      z-index: 9999;
    }
  }

  .with-sidebar > :first-child {
    flex-basis: 0;
    flex-grow: 999;
    min-inline-size: 50%;
    display: flex;
    flex-direction: column;
  }

  /* .with-sidebar > * {
    border: 1px solid var(--color-border);
  } */

  main > :not(nav):not(footer) {
    flex: 1;
  }

  .veil {
    display: none;
  }
  @supports (-webkit-touch-callout: none) {
    /* .with-sidebar:before {
      display: none;
    } */

    .veil {
      position: sticky;
      top: 0;
      z-index: 10000;
      display: block;
      pointer-events: none;
    }
    .veil-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      backdrop-filter: blur(1px);
    }
  }
</style>
